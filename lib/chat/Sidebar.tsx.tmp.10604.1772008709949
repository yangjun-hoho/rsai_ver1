'use client';

import { useState } from 'react';

export type ToolId = 'report' | 'ppt' | 'scenario' | 'merit-citation' | 'greetings' | 'press-release' | 'templates' | 'rag';

export interface Tool {
  id: ToolId;
  label: string;
  tooltip: string;
}

export const TOOLS: Tool[] = [
  { id: 'report',        label: 'ë³´ê³ ì„œ ìƒì„±',    tooltip: 'AI ìë™ ë³´ê³ ì„œ ì‘ì„±' },
  { id: 'greetings',     label: 'ì¸ì‚¬ë§ì”€ ìƒì„±',  tooltip: 'ìƒí™©ë³„ ë§ì¶¤ ì¸ì‚¬ë§ ì‘ì„±' },
  { id: 'press-release', label: 'ë³´ë„ìë£Œ ìƒì„±',  tooltip: 'íš¨ê³¼ì ì¸ ë³´ë„ìë£Œ ì‘ì„±' },
  { id: 'merit-citation', label: 'ê³µì ì¡°ì„œ ìƒì„±', tooltip: 'ê³µì ì¡°ì„œ ìë™ ì‘ì„±' },
  { id: 'scenario',      label: 'ì‹œë‚˜ë¦¬ì˜¤ ìƒì„±',  tooltip: 'ë°œí‘œ ì‹œë‚˜ë¦¬ì˜¤ ìë™ ë³€í™˜' },
  { id: 'ppt',           label: 'PPT ìƒì„±',       tooltip: 'AI ìë™ í”„ë ˆì  í…Œì´ì…˜ ì‘ì„±' },
  { id: 'document',      label: 'ë¬¸ì„œ ë¶„ì„',      tooltip: 'PDF/TXT íŒŒì¼ ì—…ë¡œë“œ ë° ì§ˆì˜ì‘ë‹µ' },
  { id: 'search',        label: 'ê²€ìƒ‰',           tooltip: 'ì›¹ì—ì„œ ì‹¤ì‹œê°„ ì •ë³´ ê²€ìƒ‰' },
  { id: 'templates',     label: 'í…œí”Œë¦¿',         tooltip: 'ê³µë¬´ì› ì—…ë¬´ íŠ¹í™” AI í…œí”Œë¦¿' },
  { id: 'rag',           label: 'Rag',            tooltip: 'ë¬¸ì„œ ê¸°ë°˜ AI ì§€ì‹ ê²€ìƒ‰' },
];

const ICON_MAP: Record<string, string> = {
  search: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>`,
  document: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>`,
  report: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>`,
  ppt: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></svg>`,
  scenario: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>`,
  'merit-citation': `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>`,
  greetings: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 10v12"/><path d="M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z"/></svg>`,
  'press-release': `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 18h8a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2z"/><rect x="7" y="7" width="8" height="5"/><line x1="8" y1="15" x2="12" y2="15"/><path d="M17 18v-1a2 2 0 0 1 2-2h2"/></svg>`,
  templates: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>`,
  rag: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>`,
  chart: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/><line x1="2" y1="20" x2="22" y2="20"/></svg>`,
};

const SHORTCUTS = [
  { id: 'work-support',      label: 'ì—…ë¬´ì§€ì›',       icon: 'âš¡', path: '/work-support' },
  { id: 'nano-banana',       label: 'Nano Banana AI',  icon: 'ğŸŒ', path: '/work-support/nano-banana' },
  { id: 'chart-editor',      label: 'ì°¨íŠ¸ ì—ë””í„°',    icon: 'ğŸ“Š', path: '/work-support/chart-editor' },
  { id: 'screen-recorder',   label: 'í™”ë©´ ë…¹í™”',      icon: 'ğŸ¬', path: '/work-support/screen-recorder' },
  { id: 'latest-tools',      label: 'ìµœì‹  AI ë„êµ¬',   icon: 'ğŸŒ', path: '/work-support/latest-tools' },
  { id: 'cadastral-map',     label: 'ì—°ì†ì§€ì ë„',      icon: 'ğŸ—ºï¸', path: '/work-support/cadastral-map' },
];

interface SidebarProps {
  activeMode: ToolId | null;
  onToolClick: (id: ToolId) => void;
}

export default function Sidebar({ activeMode, onToolClick }: SidebarProps) {
  const [open, setOpen] = useState(true);
  const [tooltip, setTooltip] = useState<{ text: string; y: number } | null>(null);

  return (
    <aside style={{
      width: open ? '260px' : '60px',
      background: '#f7f6f3',
      borderRight: '1px solid #e9e9e7',
      display: 'flex',
      flexDirection: 'column',
      flexShrink: 0,
      transition: 'width 0.3s ease',
      overflow: 'visible',
      position: 'relative',
    }}>
      {/* í—¤ë” */}
      <div style={{
        padding: open ? '0.5rem 0.5rem 0.5rem 1rem' : '0.5rem',
        borderBottom: '1px solid #e9e9e7',
        display: 'flex',
        alignItems: 'center',
        justifyContent: open ? 'space-between' : 'center',
        height: '40px',
        gap: '0.5rem',
      }}>
        {open && (
          <h2 style={{ fontSize: '1rem', fontWeight: 700, color: '#37352fda', margin: 0, whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis', flex: 1 }}>
            AI Work Space
          </h2>
        )}
        <button
          onClick={() => setOpen(!open)}
          title={open ? 'ì‚¬ì´ë“œë°” ì ‘ê¸°' : 'ì‚¬ì´ë“œë°” í¼ì¹˜ê¸°'}
          style={{ width: '32px', height: '32px', display: 'flex', alignItems: 'center', justifyContent: 'center', border: 'none', background: 'transparent', color: '#7e7e7e', borderRadius: '6px', cursor: 'pointer', flexShrink: 0 }}
          onMouseEnter={e => (e.currentTarget.style.background = 'rgba(0,0,0,0.05)')}
          onMouseLeave={e => (e.currentTarget.style.background = 'transparent')}
        >
          {open ? (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M9 3v18"/><path d="M15 9l-3 3 3 3"/></svg>
          ) : (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M9 3v18"/><path d="M13 9l3 3-3 3"/></svg>
          )}
        </button>
      </div>

      {/* ì½˜í…ì¸  */}
      <div style={{ flex: 1, overflowY: 'auto', overflowX: 'visible' }}>
        {/* ë„êµ¬ ì„¹ì…˜ */}
        <div style={{ padding: '0.75rem 0.75rem', borderBottom: '1px solid #e9e9e7' }}>
          {open && (
            <div style={{ fontSize: '0.7rem', fontWeight: 600, color: '#6b6b6b', textTransform: 'uppercase', letterSpacing: '0.025em', marginBottom: '0.5rem', paddingLeft: '0.25rem' }}>
              ë„êµ¬
            </div>
          )}
          <div style={{ display: 'flex', flexDirection: 'column', gap: '0.15rem' }}>
            {TOOLS.map((tool) => {
              const isActive = activeMode === tool.id;
              return (
                <button
                  key={tool.id}
                  onClick={() => onToolClick(tool.id)}
                  title={!open ? tool.tooltip : undefined}
                  onMouseEnter={e => {
                    if (!open) {
                      const rect = e.currentTarget.getBoundingClientRect();
                      setTooltip({ text: tool.tooltip, y: rect.top + rect.height / 2 });
                    }
                    if (!isActive) e.currentTarget.style.background = 'rgba(0,0,0,0.05)';
                  }}
                  onMouseLeave={e => {
                    setTooltip(null);
                    if (!isActive) e.currentTarget.style.background = 'transparent';
                  }}
                  style={{
                    display: 'flex',
                    alignItems: 'center',
                    gap: '0.3rem',
                    padding: open ? '0.3rem 0.25rem' : '0.5rem',
                    background: isActive ? '#e8f4ff' : 'transparent',
                    border: 'none',
                    borderRadius: '6px',
                    cursor: 'pointer',
                    color: isActive ? '#0066cc' : '#37352f',
                    fontSize: '0.8rem',
                    fontWeight: isActive ? 600 : 400,
                    width: '100%',
                    textAlign: 'left',
                    justifyContent: open ? 'flex-start' : 'center',
                    transition: 'all 0.15s ease',
                  }}
                >
                  <span
                    style={{ width: '20px', height: '20px', display: 'flex', alignItems: 'center', justifyContent: 'center', flexShrink: 0 }}
                    dangerouslySetInnerHTML={{ __html: ICON_MAP[tool.id] }}
                  />
                  {open && <span style={{ whiteSpace: 'nowrap' }}>{tool.label}</span>}
                </button>
              );
            })}
          </div>
        </div>

        {/* ë°”ë¡œê°€ê¸° ì„¹ì…˜ */}
        {open && (
          <div style={{ padding: '0.75rem 0.75rem', borderBottom: '1px solid #e9e9e7' }}>
            <div style={{ fontSize: '0.7rem', fontWeight: 600, color: '#6b6b6b', textTransform: 'uppercase', letterSpacing: '0.025em', marginBottom: '0.5rem', paddingLeft: '0.25rem' }}>
              ë°”ë¡œê°€ê¸°
            </div>
            <div style={{ display: 'flex', flexDirection: 'column', gap: '0.15rem' }}>
              {SHORTCUTS.map((sc) => (
                <a
                  key={sc.id}
                  href={sc.path}
                  style={{ display: 'flex', alignItems: 'center', gap: '0.6rem', padding: '0.3rem 0.5rem', borderRadius: '6px', textDecoration: 'none', color: '#37352f', fontSize: '0.8rem', fontWeight: 500 }}
                  onMouseEnter={e => (e.currentTarget.style.background = 'rgba(0,0,0,0.05)')}
                  onMouseLeave={e => (e.currentTarget.style.background = 'transparent')}
                >
                  <span style={{ fontSize: '1rem', width: '20px', textAlign: 'center', flexShrink: 0 }}>{sc.icon}</span>
                  <span>{sc.label}</span>
                </a>
              ))}
            </div>
          </div>
        )}
      </div>

      {/* í•˜ë‹¨ */}
      {open && (
        <div style={{ padding: '0.75rem 1rem', borderTop: '1px solid #e9e9e7' }}>
          <button
            style={{ width: '100%', display: 'flex', alignItems: 'center', gap: '0.75rem', padding: '0.5rem 0.75rem', background: 'transparent', border: 'none', borderRadius: '6px', cursor: 'pointer', color: '#37352f', fontSize: '0.875rem' }}
            onMouseEnter={e => (e.currentTarget.style.background = 'rgba(0,0,0,0.05)')}
            onMouseLeave={e => (e.currentTarget.style.background = 'transparent')}
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="3"/><path d="M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83"/></svg>
            <span>ì„¤ì •</span>
          </button>
        </div>
      )}

      {/* íˆ´íŒ (ì ‘íŒ ìƒíƒœì—ì„œ hover ì‹œ) */}
      {tooltip && !open && (
        <div style={{
          position: 'fixed',
          left: '68px',
          top: tooltip.y,
          transform: 'translateY(-50%)',
          background: '#37352fdf',
          color: '#fff',
          padding: '0.3rem 0.75rem',
          borderRadius: '6px',
          fontSize: '0.7rem',
          whiteSpace: 'nowrap',
          zIndex: 9999,
          pointerEvents: 'none',
          boxShadow: '0 4px 12px rgba(0,0,0,0.25)',
        }}>
          {tooltip.text}
          <div style={{ position: 'absolute', right: '100%', top: '50%', transform: 'translateY(-50%)', width: 0, height: 0, borderTop: '6px solid transparent', borderBottom: '6px solid transparent', borderRight: '6px solid #37352f' }} />
        </div>
      )}
    </aside>
  );
}
